# Claude Shop - 产品需求文档 (PRD)

## 📋 项目概述

### 产品名称
Claude Shop

### 产品定位
内部管理系统，用于管理AWS账号资源，提供Claude AI服务配额查看和账号销售管理功能。

### 目标用户
- **公开用户**: 需要查看可购买的拥有配额的AWS账号的客户
- **管理员**: 内部运营人员，负责账号管理和维护

## 🎯 产品目标

### 业务目标
- 提供透明的AWS账号的Claude配额信息展示
- 简化客户购买流程，提高转化率
- 提升内部账号管理效率
- 确保账号信息的实时性和准确性

### 技术目标
- 构建稳定可靠的管理后台
- 实现自动化配额更新机制
- 提供完整的操作审计功能
- 确保数据安全和访问控制

## 👥 用户角色定义

### 公开用户 (Public Users)
- **定义**: 访问系统查看AWS账号信息的潜在客户
- **权限**: 只读访问，查看公开展示的账号信息
- **使用场景**: 浏览账号、筛选需求、联系购买

### 管理员 (Administrators)
- **定义**: 系统内部运营和维护人员
- **权限**: 完整的系统管理权限
- **使用场景**: 账号管理、配额更新、数据维护

## 🔧 功能需求详述

### 公开功能模块

#### 1. 账号浏览功能
**功能描述**: 展示所有可用的AWS账号及其Claude配额信息

**具体需求**:
- 以卡片形式展示账号列表
- 显示关键信息：账号ID、可用模型、配额数量
- 支持分页浏览，每页显示5-10个账号
- 响应式设计，适配桌面和移动端
- 账号卡片显示配额状态（充足/紧张/无配额）
- 支持实时配额更新显示

**验收标准**:
- 页面加载时间 < 3秒
- 信息展示完整准确
- 移动端体验良好
- 配额信息实时同步

#### 2. 高级筛选功能
**功能描述**: 提供多维度筛选条件，帮助用户快速找到符合需求的账号

**具体需求**:
- **模型类型筛选**: 支持按Claude模型版本筛选（Claude-3.5-Sonnet, Claude-3-Haiku, Claude-3-Opus等）
- **可用状态筛选**: 仅显示可购买的账号
- **配额范围筛选**: 按配额数量区间筛选
- **多选筛选**: 支持同时选择多个模型类型
- **筛选状态保存**: 会话期间保持筛选条件

**验收标准**:
- 筛选结果实时更新
- 筛选条件清晰可见
- 支持筛选条件重置
- 无筛选结果时友好提示

#### 3. 详细信息查看
**功能描述**: 点击账号卡片查看完整的配额详情

**具体需求**:
- 弹窗或详情页展示完整信息
- 显示所有可用模型的具体配额数据
- 展示账号上架时间、最后更新时间
- 显示当前可用状态和库存情况
- 账号特殊说明或备注信息

**验收标准**:
- 信息展示完整
- 页面交互流畅
- 数据实时准确
- 弹窗/详情页响应式适配

#### 4. Telegram集成
**功能描述**: 提供便捷的联系购买渠道

**具体需求**:
- 每个账号卡片显示"联系购买"按钮
- 点击后打开Telegram对话
- 自动填充账号信息到消息中（账号ID、配额情况）
- 支持深度链接直接跳转到Telegram应用
- 预设消息模板包含必要的购买咨询信息

**验收标准**:
- 按钮功能正常
- 信息传递准确
- 跨平台兼容性良好
- 消息模板规范统一

### 管理员功能模块

#### 1. 安全认证系统
**功能描述**: 基于JWT的管理员登录验证机制

**具体需求**:
- 用户名/密码登录
- JWT Token生成和验证
- Token自动刷新机制
- 登录失败锁定机制（连续5次失败锁定30分钟）
- 会话超时自动登出（24小时）
- 记住登录状态选项
- 安全的密码重置机制

**验收标准**:
- 登录安全可靠
- Token机制工作正常
- 防护措施有效
- 会话管理稳定

#### 2. 账号管理功能
**功能描述**: 完整的AWS账号生命周期管理

**具体需求**:
- **创建账号**: 添加新的AWS账号信息
  - 账号ID、访问密钥(Access Key)、私密密钥(Secret Key)、名称、描述
  - 账号信息验证（连接测试）
  - 自动触发配额获取
- **查看账号**: 表格形式展示所有账号
  - 支持搜索和排序
  - 批量操作选择
  - 配额状态快速查看
  - 账号连接状态显示
- **编辑账号**: 修改账号基本信息
  - 密钥信息安全更新
  - 账号描述和备注编辑
- **删除账号**: 安全删除（软删除，保留历史记录）
  - 删除确认机制
  - 关联数据处理

**验收标准**:
- CRUD操作稳定可靠
- 数据验证完整
- 操作提示清晰
- 敏感信息安全处理

#### 3. 配额刷新功能
**功能描述**: 自动或手动触发账号配额更新

**具体需求**:
- **自动刷新**: 新添加的账号自动获取配额信息
- **手动刷新**: 单个或批量账号配额更新
- **定时刷新**: 可配置的定时更新机制
- **刷新进度**: 显示更新进度和状态
- **结果展示**: 刷新完成后显示更新摘要
- **错误处理**: 失败重试机制和错误日志
- **配额历史**: 保存配额变化历史记录

**验收标准**:
- 自动刷新机制稳定
- 手动刷新功能正常
- 进度显示准确
- 错误处理完善
- 历史记录完整

#### 4. 审计日志功能
**功能描述**: 记录所有管理员操作，确保可追溯性

**具体需求**:
- **操作记录**: 记录所有CRUD操作
- **认证记录**: 记录登录/登出行为
- **配额记录**: 记录配额刷新操作
- **日志内容**: 操作人、操作时间、操作类型、操作对象、操作结果、IP地址
- **查询功能**: 日志查询和多维度筛选
- **导出功能**: 支持CSV/Excel格式导出
- **保留策略**: 日志数据保留6个月
- **实时监控**: 异常操作实时告警

**验收标准**:
- 所有关键操作被记录
- 日志查询功能完善
- 导出功能正常
- 告警机制有效

#### 5. 状态管理功能
**功能描述**: 控制账号的可见性和可购买状态

**具体需求**:
- **状态类型**: 可用、售罄、维护中、已下架
- **批量操作**: 支持批量状态更新
- **变更历史**: 状态变更历史记录
- **自动规则**: 基于配额的自动状态更新
- **通知机制**: 状态变更通知
- **前台同步**: 状态变更立即同步到公开页面

**验收标准**:
- 状态控制准确
- 前台显示同步
- 变更记录完整
- 自动化规则正常工作

## 📊 数据模型设计

### 核心实体

#### AWS账号 (AwsAccount)
```
- id: 主键
- account_id: AWS账号ID (唯一)
- access_key: AWS访问密钥
- secret_key: AWS私密密钥 (加密存储)
- name: 账号名称
- description: 账号描述
- status: 状态 (available, sold_out, maintenance, offline)
- connection_status: 连接状态 (connected, error, unknown)
- created_at: 创建时间
- updated_at: 更新时间
- deleted_at: 删除时间 (软删除)
```

#### 配额信息 (Quota)
```
- id: 主键
- aws_account_id: 关联账号ID
- model_name: Claude模型名称
- quota_limit: 配额上限
- quota_used: 已使用配额
- quota_remaining: 剩余配额
- last_updated: 最后更新时间
- update_status: 更新状态 (success, failed, pending)
```

#### 配额历史 (QuotaHistory)
```
- id: 主键
- aws_account_id: 关联账号ID
- model_name: 模型名称
- quota_limit: 配额上限
- quota_used: 已使用配额
- recorded_at: 记录时间
```

#### 管理员 (Admin)
```
- id: 主键
- username: 用户名 (唯一)
- email: 邮箱
- password_hash: 密码哈希
- failed_login_attempts: 登录失败次数
- locked_until: 锁定截止时间
- last_login_at: 最后登录时间
- last_login_ip: 最后登录IP
- created_at: 创建时间
- updated_at: 更新时间
```

#### 审计日志 (AuditLog)
```
- id: 主键
- admin_id: 操作管理员ID
- action: 操作类型 (create, update, delete, login, logout, refresh_quota)
- target_type: 目标类型 (AwsAccount, Admin, Quota)
- target_id: 目标ID
- changes: 变更内容 (JSON格式)
- ip_address: 操作IP地址
- user_agent: 用户代理
- created_at: 操作时间
```

#### 系统配置 (SystemConfig)
```
- id: 主键
- key: 配置键名
- value: 配置值
- description: 配置描述
- updated_at: 更新时间
```

## 🔒 安全要求

### 认证安全
- 密码强度要求：至少8位，包含大小写字母、数字、特殊字符
- JWT Token有效期24小时，支持刷新机制
- 防暴力破解：失败5次锁定30分钟
- HTTPS强制加密传输
- 安全的密码重置流程

### 权限控制
- 基于角色的访问控制(RBAC)
- API接口权限验证
- 敏感操作二次确认
- 会话超时自动登出

### 数据安全
- AWS密钥加密存储
- 敏感数据脱敏显示
- 定期数据备份
- 完整的操作审计跟踪
- SQL注入防护
- XSS攻击防护

## 📱 用户体验要求

### 性能要求
- 页面首次加载时间 < 3秒
- API响应时间 < 1秒
- 配额刷新操作 < 30秒
- 数据库查询优化
- 静态资源CDN加速

### 易用性要求
- 直观的用户界面设计
- 清晰的操作流程指引
- 友好的错误提示信息
- 响应式设计适配各种设备
- 键盘快捷键支持

### 可访问性
- 支持键盘导航
- 适当的颜色对比度
- 屏幕阅读器兼容
- 多语言支持准备

## 🚀 技术实现要求

### 前端技术栈
- Ruby on Rails 8.0+
- Tailwind CSS 3.0+
- Stimulus + Turbo
- ViewComponent
- Hotwire

### 后端技术栈
- Ruby on Rails 8.0+
- MySQL 8.0
- JWT认证

### 外部依赖
- AWS SDK for Ruby


### 部署要求
- Docker容器化部署


